<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="utf-8">
    <title> Train Model</title>
    <link rel="stylesheet" href="../css/chessboard-1.0.0.min.css">
    <style type="text/css">
        body {
            background-color: lightgreen;
        }
        
        #boardContainer {
            display: table;
        }
        
        #board {
            float: left;
            display: block;
        }
        
        #moveMade {
            display: block;
            float: left;
            font-size: 50px;
        }
        
        button {}
    </style>
</head>

<body id="body">
    <div id="boardContainer">
        <div id="board" style="width: 400px"></div>
        <div id="moveMade">X</div>
        <br> Depth:
        <span id="depthSpan">1</span>
        <br>
        <input id="depthSlider" type="range" min="1" max="25" value="0">
    </div>
    <br>
    <button id="startTheTraining">Start Training</button>
    <button id="CreateNewModels">Create new Models</button>
    <button id="loadModel">Load Model</button>
    <br>
    <button id="playBestMove">Play best Move</button>
    <button id="predictBestMove">Predict best move</button>

    <br><br>

    <button id="updateBoard">Update Board</button>
    <br>

    <button id="testMonteSpeed">Test Monte Speed</button>

    <!-- jquery -->
    <script src="../js/jquery-3.5.1.min.js"></script>
    <!-- chessboard.js -->
    <script src="../js/chessboard-1.0.0.min.js"></script>
    <!-- chess.js -->
    <script src="../js/chess.js"></script>
    <!-- tensorflow.js -->
    <script src='../js/tf.min.js'></script>
    <!-- own scripts -->
    <script src="../js/ChessboardToNNInput.js"></script>
    <script src="../js/fenToArray.js"></script>
    <script src="../js/arrayToFen.js"></script>
    <script src="../js/pgnToArray.js"></script>
    <script src="../js/RandomNormalDistribution.js"></script>
    <script src="../js/NeuralNetwork.js"></script>
    <script src="../js/NeuralNetworkTrainer.js"></script>
    <script src="../js/monteCarloTreeSearch.js"></script>
    <script>
        document.getElementById("testMonteSpeed").addEventListener("click", () => {
            NNTrainer.monteCarloSpeedTester();
        });
        let NNTrainer;

        let depth = document.getElementById("depthSlider").value;

        var game = new Chess();
        let board = Chessboard('board', 'start');

        document.getElementById("CreateNewModels").addEventListener("click", async() => {
            NNTrainer = new NeuralNetworkTrainer(new Chess(), depth);
            let models = await CreateNewModels();
            for (let i = 0; i < models.length; i++) {
                NNTrainer.addModelToTrainer(models[i]);
            }
            await mutateModels().then(console.log("Created Models"));
            //NNTrainer.models[0].model.getWeights()[0].print();

        });

        async function mutateModels() {
            for (let index = 0; index < NNTrainer.models.length; index++) {
                NNTrainer.models[0].mutate(0.5);
            }
        }

        document.getElementById("startTheTraining").addEventListener("click", async() => {
            if (NNTrainer != null) {
                let btn = document.getElementById("startTheTraining");
                if (btn.innerHTML == "Start Training") {
                    btn.innerHTML = "Pause Training";
                    NNTrainer.keepTraining = true;
                    NNTrainer.startTheTraining;
                } else {
                    btn.innerHTML = "Start Training";
                    setTimeout(() => {
                        NNTrainer.keepTraining = false;
                    }, 100);

                }

                NNTrainer.startTraining(true);
            }
        })

        async function CreateNewModels() {
            let models = []
            for (let index = 0; index < 10; index++) {
                models.push(new NeuralNet());
            }
            return models;
        }

        document.getElementById("playBestMove").addEventListener("click", playBestMoveFunction);

        function playBestMoveFunction() {
            game.move(possibleMovesMonte[bestMoveIndex]);
            board = Chessboard('board', game.fen());
        }

        document.getElementById("predictBestMove").addEventListener("click", () => {
            monteCarloTreeSearch(depth, NNTrainer.models[0].model)
        });

        document.getElementById("updateBoard").addEventListener("click", () => {
            board = Chessboard('board', game.fen());
        });

        var slider = document.getElementById("depthSlider");
        var depthSpan = document.getElementById("depthSpan");
        depthSpan.innerHTML = slider.value;

        slider.oninput = function() {
            depthSpan.innerHTML = this.value;
            if (NNTrainer != null) {
                NNTrainer.depth = this.value;
            }
        }
    </script>
</body>

</html>