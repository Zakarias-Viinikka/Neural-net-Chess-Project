<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="utf-8">
    <title> Train Model</title>
    <link rel="stylesheet" href="../css/chessboard-1.0.0.min.css">
    <style type="text/css">
        body {
            background-color: lightgreen;
        }
    </style>
</head>

<body id="body">
    <!-- own scripts -->
    <script src="../js/fenToArray.js"></script>
    <script src="../js/arrayToFen.js"></script>
    <script src="../js/pgnToArray.js"></script>
    <!-- jquery -->
    <script src="../js/jquery-3.5.1.min.js"></script>
    <!-- chessboard.js -->
    <script src="../js/chessboard-1.0.0.min.js"></script>
    <!-- chess.js -->
    <script src="../js/chess.js"></script>
    <!-- tensorflow.js -->
    <!--<script src="tensorflowjs/tfjs/dist/tf.js"></script>-->
    <!-- use .min later maybe dunno -->
    <script src='../js/tf.min.js'></script>

    <div id="board" style="width: 400px"></div>
    <button id="startTheTraining">Train</button>
    <button id="CreateNewModels">Create new Model</button>
    <button id="startTheTraining">Load Model</button>
    <button id="playBestMove">Play best Move</button>
    <button id="predictBestMove">Predict best move</button>

    <br><br>

    <button id="updateBoard">Update Board</button>

    <script src="../js/NeuralNetwork.js"></script>
    <script src="../js/monteCarloTreeSearch.js"></script>
    <script>
        let leafMoves = []; //array for storing the leaf moves in the monte carlo tree search algorithm
        let bestMoveIndex = 0; //stores the index for the best root move so far
        let bestMoveValue = -1; //stores the value for the best prediction so far
        let possibleMovesMonte; //possibleMoves but as a global variable for the monte carlo tree search
        let boardBeforeMonte;


        var game = new Chess();
        let board = Chessboard('board', 'start');
        let neuralNetFinalArray = [];

        let models = [];

        /*async function createTrainingData(gameIndex) {
            game.load('rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1'); //starting board
            let possibleMoves = [];
            let originalBoard = "";
            let futureBoard = "";
            let trainingData = [];

            for (let i = 0; i < carlsenAsArray.length; i++) { //for every move that has been made in a game
                if (trainingLimitForTesting > 0) {
                    if (i >= trainingLimitForTesting) {
                        i = carlsenAsArray.length;
                    }
                }
                possibleMoves = game.moves();
                originalBoard = game.fen();
                //add training data//
                for (var v = 0; v < possibleMoves.length; v++) { //for every possible move for a particular board state
                    let possibleBoard = game.fen(); //gets the board as FEN from chess.js
                    let input = getNeuralInputFromFen();
                    //Finished with the input array

                    //adds training data
                    let tfinput = tf.tensor2d([input])
                    let target;

                    if (possibleMoves[v] == carlsenAsArray[i]) { //checks if the move is the one that was made in the original game
                        target = tf.tensor1d([1]);
                    } else {
                        target = tf.tensor1d([-1]);
                    }
                    const response = await model.fit([tfinput], [target] );
                    //console.log(response.history.loss[0]);
                    tf.dispose(tfinput);
                    tf.dispose(target);
                    //resets board
                    game.load(originalBoard);
                }
                //updates board for next move
                game.move(carlsenAsArray[i]);
            }
            
            finishedTraining();
        }
        */
        async function trainTheModel() {
            //do evolution
        }

        document.getElementById("CreateNewModels").addEventListener("click", () => {
            CreateNewModels();
        });

        async function CreateNewModels() {
            for (let index = 0; index < 10; index++) {
                let tempModel = new NeuralNet();
                await models.push(tempModel);
                await models[0].testModel();
                console.log("created model");
            }
        }




        document.getElementById("playBestMove").addEventListener("click", playBestMoveFunction);

        function playBestMoveFunction() {
            game.move(possibleMovesMonte[bestMoveIndex]);
            board = Chessboard('board', game.fen());
        }

        document.getElementById("predictBestMove").addEventListener("click", predictBestMoveFunction);

        function predictBestMoveFunction() {
            monteCarloTreeSearch(5);
        }

        document.getElementById("updateBoard").addEventListener("click", () => {
            board = Chessboard('board', game.fen());
        });
    </script>
</body>

</html>